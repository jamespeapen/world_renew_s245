---
title: "Assets model"
author: "Ivanna Rodriguez"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document:
    fig_height: 2.2
    fig_width: 4
  pdf_document:
    fig_height: 2.2
    fig_width: 4
  word_document:
    fig_height: 2.2
    fig_width: 4
---

```{r, setup, include = FALSE}
# load packages that are going to be used
require(tidyverse)   # this loads mosaic, ggformula, etc. too
require(ggformula)
require(mosaic)

# to read excel files
require(readxl)
# for collinearity
require(GGally)
# for IC
require(MuMIn)
# for VIF
require(car)

# Some customization.  You can alter or delete as desired (if you know what you are doing).

theme_set(theme_bw(base_size=12))     # change theme for ggplot2/ggformula

knitr::opts_chunk$set(
  echo = TRUE,      # for homework, always show R code (this is the default)
  tidy = FALSE,     # display code as typed (rather than reformatted)
  size = "small",   # slightly smaller font for code
  message = FALSE, warning = FALSE) # don't print warnings or messages in compiled document. So you MUST check them in RStudio!
```


```{r}
# reading in the data
bihs <- read.csv('bihs_final.csv')
bihs_original <- read_excel('../tidy_dataset/BIHS_household_2011_15.xlsx')
```


## Notes from World Renew
The regression analysis that was done of the World Renew data showed statistically significant relationships between certain types of asset ownership (house, farm tools, bicycles and livestock) and the food frequency score (FFS).

* Construct a similar regression using those variables in the BIHS dataset that are the same, or similar, such as regressing "house_owned" and "asset_cartplough." with "food consumption score" (fcs)

```{r}
# adding house_owned variable to bihs dataset
bihs <- bihs %>% mutate(house_owned = bihs_original$house_owned)
# removing NA rows
bihs %>% na.omit()
```

```{r}
# exploring the data
head(bihs)
glimpse(bihs)
```
## Exploratory Plots
```{r}
# whether they owned/rented a house
gf_boxplot(data = bihs, fcs ~ house_owned)

# tech assets
gf_boxplot(data = bihs, fcs ~ asset_cartplough)
gf_boxplot(data = bihs, fcs ~ asset_tractor)
gf_boxplot(data = bihs, fcs ~ asset_motorbike)
gf_boxplot(data = bihs, fcs ~ asset_telephone)
gf_boxplot(data = bihs, fcs ~ asset_radio)
```

```{r}
# livestock assets
gf_point(data = bihs, fcs ~ asset_qty_poultry)%>%
  gf_lm(color = 'red', size = 1)
gf_point(data = bihs, fcs ~ asset_qty_cattle)%>%
  gf_lm(color = 'red', size = 1)
gf_point(data = bihs, fcs ~ asset_qty_otherlivestock)%>%
  gf_lm(color = 'red', size = 1)
gf_point(data = bihs, fcs ~ asset_qty_sheepgoat)%>%
  gf_lm(color = 'red', size = 1)
```

```{r}
# checking for collinearity in quantitative predictors
predictors <- bihs %>% select(
                              asset_qty_poultry,
                              asset_qty_cattle,
                              asset_qty_otherlivestock,
                              asset_qty_sheepgoat,
                              )
ggpairs(predictors)
ggcorr(predictors)
```

## Fitting the model

```{r}
asset_lm <- lm(data = bihs, fcs ~ house_owned + asset_cartplough)
summary(asset_lm)
vif(asset_lm)
```

```{r}
asset_lm_tech <- lm(data = bihs, fcs ~ asset_cartplough + asset_tractor + asset_motorbike + asset_telephone + asset_radio)
summary(asset_lm_tech)
vif(asset_lm_tech)
```

```{r}
asset_lm_livestock <- lm(data = bihs, fcs ~ asset_qty_poultry + asset_qty_cattle + asset_qty_otherlivestock + asset_qty_sheepgoat)
summary(asset_lm_livestock)
vif(asset_lm_livestock)
```

```{r}
asset_lm_all <- lm(data = bihs, fcs ~ asset_cartplough + asset_tractor + asset_motorbike + asset_telephone + asset_radio + asset_qty_poultry + asset_qty_cattle + asset_qty_otherlivestock + asset_qty_sheepgoat)
summary(asset_lm_all)
vif(asset_lm_all)
```

## Exploring possible interaction between tech assets and year

```{r}
gf_boxplot(fcs ~ house_owned | year, data = bihs) # there seems to be an interaction here?
gf_boxplot(fcs ~ asset_cartplough | year, data = bihs)
gf_boxplot(fcs ~ asset_telephone | year, data = bihs)
gf_boxplot(fcs ~ asset_motorbike | year, data = bihs)
gf_boxplot(fcs ~ asset_tractor | year, data = bihs)
gf_boxplot(fcs ~ asset_radio | year, data = bihs)
```

## Fitting a model with interaction
```{r}
asset_lm_interaction <- lm(data = bihs, fcs ~ house_owned*year + asset_cartplough + asset_tractor + asset_motorbike + asset_telephone + asset_radio + asset_qty_poultry + asset_qty_cattle + asset_qty_otherlivestock + asset_qty_sheepgoat)
summary(asset_lm_interaction)
```

## Checking conditions
```{r}
# for the tech assets model
bihs1 <- bihs
bihs1 <- select(
                asset_radio,
                asset_telephone,
                asset_tractor,
                asset_television
              ) %>%
  na.omit()
bihs1 <- bihs1 %>%
  mutate(res = resid(asset_lm_tech),
         fitted = predict(asset_lm_tech))
gf_point(res ~ fitted, data = bihs) %>%
  gf_labs(x = 'Fitted Values', y = 'Residuals')
```



* In the case of changes in household assets, Section 11 of the document says that there was a regression that was done of changes in household assets with food frequency scores with the World Renew data.

* Take a look at the "regression results" spreadsheet to see which types of regression relationships were found to be statistically significant within the World Renew dataset (in the household assets example, these would be relationships like the statistically significant relationships between ownership of houses, farm tools, bicycles and food frequency scores)



  